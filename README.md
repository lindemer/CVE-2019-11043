# CVE-2019-11043
PHP-FPM Remote Code Execution

Screencast: [https://youtu.be/d6benC5FVZM](https://youtu.be/d6benC5FVZM)

## Overview
This zero-day exploit in common PHP-FPM configurations was discovered during the _Realworld CTF_ competition in 2019. The vulnerability stems from a bug in FastCGI's regex parser implementation. The server expects URIs in the form `GET /script.php/path_info`, but newline characters `%0a` are not properly handled, allowing a carefully-constructed input to overwrite internal FastCGI configuration variables.

The original Go implementation of this exploit can be found in [here](https://github.com/neex/phuip-fpizdam). I have used this and other explanations of the vulnerability as learning resources in order to implement the exploit in Python.

## Instructions

**Docker on Linux** Run `sudo docker run --rm -ti -p 8080:80 reproduce-cve-2019-11043` to instantiate a barebone NGINX/PHP-FPM server with an empty script at `/script.php`. The Dockerfile for this image is available [here](https://github.com/neex/phuip-fpizdam). 

**Docker on Mac** Run `sudo docker-compuse up -d` from the `/php/CVE-2019-11043` directory of the [vulhub](https://github.com/vulhub/vulhub) repository. (Compose is included with desktop installations of Docker on Mac but not Linux. This should build faster than the Linux option.)

Run the exploit script with the command `python3 exploit.py http://localhost:8080/script.php` (or `/index.php` if the second option was used). Upon successful execution, a Web shell will be accessible by appending commands to the URL after `?a=` (e.g., `http://localhost:8080/script.php?a=uname -a`).

## Theory
